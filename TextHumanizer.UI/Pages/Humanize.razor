@page "/humanize"
@inject IApiService ApiService
@inject IJSRuntime JS

<PageTitle>Humanize Text - TextHumanizer</PageTitle>

<div class="page humanize-page">
    <div class="page-header">
        <h1>Humanize Text</h1>
        <p>Transform AI-generated text into natural, human-sounding writing.</p>
    </div>

    <div class="content-grid">
        <div class="input-section">
            <div class="card">
                <div class="card-header">
                    <h2>Input</h2>
                    <div class="tone-selector">
                        <label>Tone:</label>
                        <select @bind="_request.Tone" class="select">
                            <option value="Casual">Casual</option>
                            <option value="Formal">Formal</option>
                            <option value="Academic">Academic</option>
                        </select>
                    </div>
                </div>
                <div class="card-body">
                    <textarea
                        @bind="_request.Text"
                        @bind:event="oninput"
                        class="textarea"
                        placeholder="Paste your AI-generated text here..."
                        rows="12"></textarea>

                    <div class="input-footer">
                        <span class="char-count">@_request.Text.Length characters</span>
                        <button
                            class="btn btn-primary"
                            @onclick="HumanizeText"
                            disabled="@(_isLoading || string.IsNullOrWhiteSpace(_request.Text))">
                            @if (_isLoading)
                            {
                                <span class="spinner"></span>
                                <span>Processing...</span>
                            }
                            else
                            {
                                <span>Humanize</span>
                            }
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="output-section">
            <div class="card @(_hasResult ? "has-result" : "")">
                <div class="card-header">
                    <h2>Result</h2>
                    @if (_hasResult)
                    {
                        <button class="btn btn-ghost btn-sm" @onclick="CopyToClipboard">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="icon-sm">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                            </svg>
                            @(_copied ? "Copied!" : "Copy")
                        </button>
                    }
                </div>
                <div class="card-body">
                    @if (_hasResult)
                    {
                        <div class="result-text">@_response?.HumanizedText</div>
                    }
                    else if (_error != null)
                    {
                        <div class="error-message">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="12" y1="8" x2="12" y2="12"></line>
                                <line x1="12" y1="16" x2="12.01" y2="16"></line>
                            </svg>
                            <span>@_error</span>
                        </div>
                    }
                    else
                    {
                        <div class="placeholder-text">
                            Your humanized text will appear here...
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    private HumanizeRequest _request = new();
    private HumanizeResponse? _response;
    private bool _isLoading;
    private bool _hasResult;
    private string? _error;
    private bool _copied;

    private async Task HumanizeText()
    {
        _isLoading = true;
        _error = null;
        _hasResult = false;
        _copied = false;

        try
        {
            _response = await ApiService.HumanizeAsync(_request);
            _hasResult = _response != null;
        }
        catch (Exception ex)
        {
            _error = $"Failed to humanize text: {ex.Message}";
        }
        finally
        {
            _isLoading = false;
        }
    }

    private async Task CopyToClipboard()
    {
        if (_response?.HumanizedText != null)
        {
            await JS.InvokeVoidAsync("clipboardInterop.copyText", _response.HumanizedText);
            _copied = true;
            StateHasChanged();
            await Task.Delay(2000);
            _copied = false;
            StateHasChanged();
        }
    }
}
